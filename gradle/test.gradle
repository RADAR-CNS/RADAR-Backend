configurations {
    integrationTestImplementation {
        extendsFrom testImplementation
    }
    integrationTestRuntimeOnly.extendsFrom testRuntimeOnly
}

//---------------------------------------------------------------------------//
// Source Set                                                                //
//----------
// -----------------------------------------------------------------//
sourceSets {
    integrationTest {
        java {
            compileClasspath += sourceSets.main.output
            runtimeClasspath += sourceSets.main.output
        }
        resources {
            srcDir 'src/integrationTest/resources'
        }
    }
}

dependencies {
    // Testing
    testImplementation group: 'junit', name: 'junit', version: junitVersion
    testImplementation group: 'org.mockito', name: 'mockito-core', version: mockitoVersion
    testImplementation group: 'org.hamcrest', name: 'hamcrest-all', version: hamcrestVersion

    // Mock mail server
    testImplementation group: 'org.subethamail', name: 'subethasmtp', version: subethamailVersion

    integrationTestImplementation group: 'org.radarcns', name: 'radar-schemas-tools', version: radarSchemasVersion
    testImplementation group: 'log4j', name: 'log4j', version: log4jVersion
    testImplementation group: 'org.slf4j', name: 'slf4j-log4j12', version: slf4jVersion

    integrationTestImplementation group: 'junit', name: 'junit', version: junitVersion
    integrationTestImplementation group: 'org.mockito', name: 'mockito-core', version: mockitoVersion
    integrationTestImplementation group: 'org.hamcrest', name: 'hamcrest-all', version: hamcrestVersion

    integrationTestImplementation group: 'log4j', name: 'log4j', version: log4jVersion
    integrationTestImplementation group: 'org.slf4j', name: 'slf4j-log4j12', version: slf4jVersion
}

tasks.matching {it instanceof Test}.all {
    testLogging {
        showStandardStreams = true
        showExceptions = true
        showCauses = true
        showStackTraces = true
        exceptionFormat "full"
    }
}

test {
    useJUnit()
}

task integrationTest(type: Test) {
    description = "Run integration tests (located in src/integrationTest/...)."
    testClassesDirs = sourceSets.integrationTest.output.classesDirs
    classpath = sourceSets.integrationTest.runtimeClasspath

    testLogging.events "skipped", "failed", "passed"
}

check.dependsOn integrationTestClasses

// Do not do integration test yet, but check if integration tests compile
//check.dependsOn integrationTestClasses

test.testLogging.events "skipped", "failed"
